# 阶段二：双数据库智能存储方案

## 1. 项目概述

### 1.1 背景介绍
本项目实现了基于双数据库架构的 LLM 高级记忆系统，通过结合 ChromaDB 和 SQLite 的优势，实现了语义检索与时序查询的完美结合，显著提升了模型的上下文理解能力和对话连贯性。

### 1.2 核心特性
- 双数据库协同：融合向量数据库和关系型数据库的优势
- 智能记忆检索：支持语义相似度搜索和时序记忆获取
- 高性能处理：优化的文本分块和向量检索机制
- 可扩展架构：支持分布式部署和横向扩展


## 2. 系统架构

### 2.1 整体架构
```
[用户界面层]
    ↓
[对话管理层] → 输入处理 → 上下文构建
    ↓
[记忆检索层] → 语义检索(ChromaDB) + 时序检索(SQLite)
    ↓
[存储层] → 向量存储 + 关系存储
```

### 2.2 核心模块

#### 2.2.1 向量存储模块（ChromaDB）
- 功能：语义相似度检索
- 数据结构：
  - 文本向量（512维）
  - 元数据（时间戳、标签）
  - 原始文本
- 检索机制：
  - 余弦相似度计算
  - Top-K 召回
  - 相似度阈值过滤

#### 2.2.2 关系存储模块（SQLite）
- 功能：时序数据管理
- 表结构：
  - 对话记录表
  - 会话管理表
  - 配置表
- 索引优化：
  - 时间戳索引
  - 会话ID索引

#### 2.2.3 文本处理模块
- 智能分块：
  - 基于语义边界
  - 可配置块大小
  - 重叠机制
- 向量编码：
  - 模型：all-MiniLM-L6-v2
  - 维度：512
  - GPU加速支持

#### 2.2.4 混合检索模块
- 检索策略：
  - 语义相似度优先
  - 时间衰减因子
  - 混合排序算法
- 参数配置：
  - 相似度阈值
  - 时间窗口
  - 返回结果数量

## 3. 技术特性

### 3.1 性能优化
- 向量索引：HNSW 算法
- 批量处理：异步写入
- 缓存机制：LRU缓存

### 3.2 可靠性保证
- 数据一致性：事务管理
- 故障恢复：WAL日志
- 备份策略：增量备份

### 3.3 扩展性设计
- 模块化架构
- 插件化接口
- 配置中心
